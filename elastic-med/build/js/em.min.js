!function(){var a=function(b,c,d){var e=a.resolve(b);if(null===e){d=d||b,c=c||"root";var f=new Error('Failed to require "'+d+'" from "'+c+'"');throw f.path=d,f.parent=c,f.require=!0,f}var g=a.modules[e];if(!g._resolving&&!g.exports){var h={};h.exports={},h.client=h.component=!0,g._resolving=!0,g.call(this,h.exports,a.relative(e),h),delete g._resolving,g.exports=h.exports}return g.exports};a.modules={},a.aliases={},a.resolve=function(b){"/"===b.charAt(0)&&(b=b.slice(1));for(var c=[b,b+".js",b+".json",b+"/index.js",b+"/index.json"],d=0;d<c.length;d++){if(b=c[d],a.modules.hasOwnProperty(b))return b;if(a.aliases.hasOwnProperty(b))return a.aliases[b]}},a.normalize=function(a,b){var c=[];if("."!=b.charAt(0))return b;a=a.split("/"),b=b.split("/");for(var d=0;d<b.length;++d)".."==b[d]?a.pop():"."!==b[d]&&""!==b[d]&&c.push(b[d]);return a.concat(c).join("/")},a.register=function(b,c){a.modules[b]=c},a.alias=function(b,c){if(!a.modules.hasOwnProperty(b))throw new Error('Failed to alias "'+b+'", it does not exist');a.aliases[c]=b},a.relative=function(b){function c(a,b){for(var c=a.length;c--;)if(a[c]===b)return c;return-1}var d=a.normalize(b,".."),e=function(c){var d=e.resolve(c);return a(d,b,c)};return e.resolve=function(e){var f=e.charAt(0);if("/"==f)return e.slice(1);if("."==f)return a.normalize(d,e);var g=b.split("/"),h=c(g,"deps")+1;return h||(h=0),e=g.slice(0,h+1).join("/")+"/deps/"+e},e.exists=function(b){return a.modules.hasOwnProperty(e.resolve(b))},e};var b=this;b.require="undefined"!=typeof b.require?b.require:a,function(){b.require.register("em/src/app.js",function(a,b,c){var d,e,f,g,h,i,j;i=b("./modules/results"),j=b("./modules/state"),e=b("./modules/ejs"),g=b("./modules/query"),h=b("./modules/render"),f=b("./modules/helpers"),d=can.Control({init:function(){var a,c,d,e,g;for(g=["document","label","results","search","title"],d=0,e=g.length;e>d;d++)c=g[d],b("./components/"+c);return a=b("./templates/layout"),this.element.html(h(a,f))},route:function(){var a;return a=b("./templates/page/index"),this.render(a,{},"ElasticMed")},"doc/:oid route":function(a){var c,d,f,g,h=this;return g=a.oid,f=function(a){var c,d;return c=b("./templates/page/detail"),d=a.attr("title").value,h.render(c,a,""+d+" - ElasticMed")},c=null,(d=i.attr("docs")).length&&d.each(function(a){return c?void 0:a.attr("oid")===g?c=a:void 0}),c?f(c):e.get(g,function(a,b){return a?j.error(a):f(b)})},render:function(a,b,c){return this.element.find(".content").html(h(a,b)),document.title=c}}),c.exports=function(a){var b,c,f;return c=a.service,b=a.index,f=a.type,e.attr({index:b,type:f,client:new $.es.Client({hosts:c})}),new d(a.el),can.route.ready(),can.route.current("")?g(a.query||""):void 0}}),b.require.register("em/src/components/document.js",function(a,b,c){c.exports=can.Component.extend({tag:"app-document",template:b("../templates/document"),scope:{linkToDetail:"@"},helpers:{ago:function(a){var b,c,d,e;return e=a(),d=e.year,c=e.month,b=e.day,moment([d,c,b].join(" ")).fromNow()},date:function(a){var b,c,d,e;return e=a(),b=e.day,c=e.month,d=e.year,[b,c,d].join(" ")},isPublished:function(a,b){var c,d,e,f,g;return g=a(),c=g.day,d=g.month,f=g.year,e=+moment([c,d,f].join(" ")),(e||1/0)>+new Date?b.inverse(this):b.fn(this)},author:function(a){var b;return(b=a.collectivename)?b:a.forename+" "+a.lastname},highlight:function(a){var b,c,d,e,f,g;if(a=a(),!_.isObject(a))return a;if(!a.highlights.length)return a.value;for(g=a.highlights,e=0,f=g.length;f>e;e++)c=g[e],d=c.replace(/<\/?em>/g,""),b=a.value.replace(d,c);return b},hint:function(a,b){var c,d,e,f,g,h;if((a=a())<b)return a;for(h=e=a.split(" "),c=f=0,g=h.length;g>f;c=++f)if(d=h[c],b-=d.length,!(b>0))return e.slice(0,+c+1||9e9).join(" ")+" ..."}}})}),b.require.register("em/src/components/label.js",function(a,b,c){var d;d=b("../modules/colorize"),c.exports=can.Component.extend({tag:"app-label",template:b("../templates/label"),helpers:{bg:function(a){return d(a())},fg:function(a){var b,c;return b=d(a()),c=d3.hsl(b).l,.5>c?"light":"dark"},round:function(a){return Math.round(100*a())}}})}),b.require.register("em/src/components/results.js",function(a,b,c){var d;d=b("../modules/results"),c.exports=can.Component.extend({tag:"app-results",template:b("../templates/results"),scope:function(){return d}})}),b.require.register("em/src/components/search.js",function(a,b,c){var d,e,f;e=b("../modules/query"),d=b("../modules/ejs"),f=can.compute(e()),c.exports=can.Component.extend({tag:"app-search",template:b("../templates/search"),scope:function(){return{query:{value:e},suggestion:{value:f}}},events:{"a.button click":function(){return e(this.element.find("input").val())},"input.text keydown":function(a,b){return 9===(b.keyCode||b.which)?(a.val(f()),b.preventDefault()):void 0},"input.text keyup":function(a,b){var c,g;if(f(g=a.val()),g.length){if(13===(b.keyCode||b.which))return e(g);if(!g.slice(-1).match(/\s/))return d.suggest(c=g.split(/\s+/).pop(),function(a,b){var d;if(!a&&b[c]&&(d=function(){var a,d,e,f;for(f=b[c],d=0,e=f.length;e>d;d++)if(a=f[d].text,!a.indexOf(c))return a}()))return f(g.slice(0,g.lastIndexOf(c))+d)})}}}})}),b.require.register("em/src/components/title.js",function(a,b,c){var d;d=b("../modules/state"),c.exports=can.Component.extend({tag:"app-title",template:b("../templates/title"),scope:function(){return d}})}),b.require.register("em/src/models/document.js",function(a,b,c){var d,e,f=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};e=window.localStorage,c.exports=d=can.Model.extend({}),d.List=d.List.extend({dbName:"elastic-med",keys:null,init:function(a,b){var c,d,g,h,i,j,k,l,m,n;if(null==b&&(b=!1),d=e.getItem(this.dbName),this.keys=d&&d.split(",")||[],b&&this.keys.length){for(l=this.keys,n=[],h=0,j=l.length;j>h;h++)g=l[h],n.push(this.push(JSON.parse(e.getItem(""+this.dbName+"-"+g))));return n}for(i=0,k=a.length;k>i;i++)c=a[i],e.setItem(""+this.dbName+"-"+c.oid,JSON.stringify(c)),m=c.oid,f.call(this.keys,m)<0&&this.keys.push(c.oid);return e.setItem(this.dbName,this.keys.join(","))},destroy:function(){var a,b,c,d;for(d=this.keys,b=0,c=d.length;c>b;b++)a=d[b],e.removeItem(""+this.dbName+"-"+a);return e.removeItem(this.dbName),this.keys=[]}})}),b.require.register("em/src/modules/colorize.js",function(a,b,c){var d,e,f;d=colorbrewer.YlOrRd[9],f=.2,e=2.5,c.exports=function(){var a;return a=d3.scale.linear().domain(d3.range(f,e,(e-f)/(d.length-1))).range(d),_.memoize(function(b){return a(Math.max(f,Math.min(e,b)))})}()}),b.require.register("em/src/modules/ejs.js",function(a,b,c){c.exports=new can.Map({client:null,index:null,type:null,size:10,search:function(a,b){return this.client?this.client.search({index:this.index,type:this.type,body:{size:this.size,query:{multi_match:{query:a,fields:["title^2","keywords^2","abstract"]}},highlight:{fields:{title:{},"abstract":{}}}}}).then(function(a){var c,d,e;try{c=JSON.parse(a.body)}catch(f){return e=f,b("Malformed response")}return d=_.map(c.hits.hits,function(a){var b,c,d,e,f,g;f=a._score,e=a._id,g=a._source,b=a.highlight,g.score=f,g.oid=e;for(c in g)d=g[c],("title"===c||"abstract"===c)&&(g[c]={value:d,highlights:(null!=b?b[c]:void 0)||[]});return g}),b(null,{docs:d,total:c.hits.total})},b):b("Client is not setup")},get:function(a,b){return this.client?this.client.get({index:this.index,type:this.type,id:a}).then(function(a){var c,d;try{c=JSON.parse(a.body)}catch(e){return d=e,b("Malformed response")}return b(null,new can.Map(_.extend(c._source,{oid:c._id})))},b):b("Client is not setup")},suggest:function(a,b){var c;return this.client?(c={completion:{text:a,term:{field:"title"}}},this.client.suggest({index:this.index,body:c}).then(function(d){var e,f,g,h,i,j,k;try{c=JSON.parse(d.body)}catch(l){return e=l,b("Malformed response")}for(f={},j=c.completion,h=0,i=j.length;i>h;h++)k=j[h],a=k.text,g=k.options,f[a]=g;return b(null,f)},b)):b("Client is not setup")}})}),b.require.register("em/src/modules/helpers.js",function(a){var b,c;a.link=c=function(a){return a?can.route.url({oid:a()}):"#!"},a.ifs=b=function(a,b){return _.isFunction(a)&&(a=a()),"true"===a?b.fn(this):b.inverse(this)},Mustache.registerHelper("link",c),Mustache.registerHelper("ifs",b)}),b.require.register("em/src/modules/query.js",function(a,b,c){var d,e,f;d=b("./ejs"),f=b("./state"),e=can.compute(""),e.bind("change",function(a,b){return b?(f.loading(),d.search(b,function(a,b){var c,d;return d=b.total,c=b.docs,a?f.error(a):d?f.hasResults(d,c):f.noResults()})):void 0}),c.exports=e}),b.require.register("em/src/modules/render.js",function(a,b,c){c.exports=function(a,b){return null==b&&(b={}),can.view.mustache(a)(b)}}),b.require.register("em/src/modules/results.js",function(a,b,c){var d;d=b("../models/document"),c.exports=new can.Map({total:0,docs:new d.List([],!0)})}),b.require.register("em/src/modules/state.js",function(a,b,c){var d,e,f,g,h;g=b("./results"),f=b("./ejs"),d=b("../models/document"),e=can.Map.extend({loading:function(){return h.attr("text","Loading results &hellip;").attr("class","info"),g.attr("docs").destroy(),g.attr("total",0)},hasResults:function(a,b){return h.attr("class","info"),a>f.attr("size")?h.attr("text","Top results out of "+a+" matches"):1===a?h.attr("text","1 Result"):h.attr("text",""+a+" Results"),g.attr("docs").destroy(),g.attr("total",a).attr("docs",new d.List(b))},noResults:function(){return h.attr("text","No results found").attr("class","info"),g.attr("docs").destroy(),g.attr("total",0)},error:function(a){var b;switch(b="Error",!1){case!_.isString(a):b=a;break;case!_.isObject(a&&a.message):b=a.message}return h.attr("text",b).attr("class","alert"),g.attr("docs").destroy(),g.attr("total",0)}}),c.exports=h=new e({text:"Search ready","class":"info"})}),b.require.register("em/src/templates/breadcrumbs.js",function(a,b,c){c.exports=['<nav class="ink-navigation">','    <ul class="breadcrumbs">',"        <li><a>Start</a></li>","        <li><a>Level 1</a></li>","        <li><a>Level 2</a></li>",'        <li class="current"><a>Current item</a></li>',"    </ul>","</nav>"].join("\n")}),b.require.register("em/src/templates/document.js",function(a,b,c){c.exports=['<div class="body">','    <div class="title">',"        <app-label></app-label>",'        <h4 class="highlight">{{{ highlight title }}}</h4>',"    </div>","",'    <ul class="authors">',"        {{ #authors }}","        {{ #if affiliation }}",'        <li><span class="hint--top" data-hint="{{ hint affiliation 30 }}">{{ author this }}</span></li>',"        {{ else }}","        <li>{{ author this }}</li>","        {{ /if }}","        {{ /authors }}","    </ul>","",'    <em class="journal">in {{ journal }}</em>',"","    {{ #isPublished issue.published }}",'    <div class="meta hint--top" data-hint="{{ date issue.published }}">Published {{ ago issue.published }}</div>',"    {{ else }}",'    <div class="meta">In print</div>',"    {{ /isPublished }}","","    {{ #id.pubmed }}",'    <div class="meta">','    PubMed: <a target="new" href="http://www.ncbi.nlm.nih.gov/pubmed/{{ id.pubmed }}">{{ id.pubmed }}</a>',"    </div>","    {{ /id.pubmed }}","    ","    {{ #id.doi }}",'    <div class="meta">','    DOI: <a target="new" href="http://dx.doi.org/{{ id.doi }}">{{ id.doi }}</a>',"    </div>","    {{ /id.doi }}","</div>","","{{ #ifs linkToDetail }}",'<a class="preview" href="{{ link oid }}">','    <div class="abstract highlight">',"        {{{ highlight abstract }}}",'        <div class="fa fa-eye"></div>',"    </div>","</a>","{{ else }}",'<div class="abstract highlight">',"    {{{ highlight abstract }}}","</div>","{{ /ifs }}"].join("\n")}),b.require.register("em/src/templates/label.js",function(a,b,c){c.exports=["{{ #score }}",'<span class="score {{ fg score }}" style="background-color:{{ bg score }}">{{ round score }}</span>',"{{ /score }}"].join("\n")}),b.require.register("em/src/templates/layout.js",function(a,b,c){c.exports=['<div class="box">','    <h2><a href="{{ link null }}">ElasticMed</a></h2>',"    <p>An example app searching through an example collection of cancer related publications.</p>",'    <div class="content"></div>',"</div>"].join("\n")}),b.require.register("em/src/templates/notification.js",function(a,b,c){c.exports=["{{ #state.alert.show }}",'<div class="alert-box {{ state.alert.type }}">',"    <p>{{{ state.alert.text }}}</p>",'    <a class="close">&times;</a>',"</div>","{{ /state.alert.show }}"].join("\n")}),b.require.register("em/src/templates/page/detail.js",function(a,b,c){c.exports=['<div class="page detail">',"    <app-title></app-title>",'    <div class="document detail">','        <app-document link-to-detail="false"></app-document>',"    </div>","<div>"].join("\n")}),b.require.register("em/src/templates/page/index.js",function(a,b,c){c.exports=['<div class="page index">',"    <app-search></app-search>","    <app-title></app-title>","    <app-results></app-results>","</div>"].join("\n")}),b.require.register("em/src/templates/results.js",function(a,b,c){c.exports=["{{ #total }}",'<ul class="results">',"    {{ #docs }}",'    <li class="document result">','        <app-document link-to-detail="true"></app-document>',"    </li>","    {{ /docs }}","</ul>","{{ /total }}"].join("\n")}),b.require.register("em/src/templates/search.js",function(a,b,c){c.exports=['<div class="row collapse">','    <div class="large-10 columns search">','        <input class="auto" type="text" placeholder="" value="{{ suggestion.value }}">','        <input class="text" type="text" placeholder="Query..." value="{{ query.value }}">',"    </div>",'    <div class="large-2 columns">','        <a class="button secondary postfix">','            <span class="fa fa-search"></span> Search',"        </a>","    </div>","</div>"].join("\n")}),b.require.register("em/src/templates/title.js",function(a,b,c){c.exports=['<h3 class="{{ class }}">{{{ text }}}</h3>'].join("\n")})}();var c=b.require("em/src/app.js");"undefined"!=typeof define&&define.amd?define("em",[],function(){return c}):"undefined"!=typeof module&&module.exports?module.exports=c:b.em=c,b.require.alias("em/src/app.js","em/index.js")}();