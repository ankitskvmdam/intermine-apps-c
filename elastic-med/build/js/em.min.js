!function(){var a=function(b,c,d){var e=a.resolve(b);if(null===e){d=d||b,c=c||"root";var f=new Error('Failed to require "'+d+'" from "'+c+'"');throw f.path=d,f.parent=c,f.require=!0,f}var g=a.modules[e];if(!g._resolving&&!g.exports){var h={};h.exports={},h.client=h.component=!0,g._resolving=!0,g.call(this,h.exports,a.relative(e),h),delete g._resolving,g.exports=h.exports}return g.exports};a.modules={},a.aliases={},a.resolve=function(b){"/"===b.charAt(0)&&(b=b.slice(1));for(var c=[b,b+".js",b+".json",b+"/index.js",b+"/index.json"],d=0;d<c.length;d++){if(b=c[d],a.modules.hasOwnProperty(b))return b;if(a.aliases.hasOwnProperty(b))return a.aliases[b]}},a.normalize=function(a,b){var c=[];if("."!=b.charAt(0))return b;a=a.split("/"),b=b.split("/");for(var d=0;d<b.length;++d)".."==b[d]?a.pop():"."!==b[d]&&""!==b[d]&&c.push(b[d]);return a.concat(c).join("/")},a.register=function(b,c){a.modules[b]=c},a.alias=function(b,c){if(!a.modules.hasOwnProperty(b))throw new Error('Failed to alias "'+b+'", it does not exist');a.aliases[c]=b},a.relative=function(b){function c(a,b){for(var c=a.length;c--;)if(a[c]===b)return c;return-1}var d=a.normalize(b,".."),e=function(c){var d=e.resolve(c);return a(d,b,c)};return e.resolve=function(e){var f=e.charAt(0);if("/"==f)return e.slice(1);if("."==f)return a.normalize(d,e);var g=b.split("/"),h=c(g,"deps")+1;return h||(h=0),e=g.slice(0,h+1).join("/")+"/deps/"+e},e.exists=function(b){return a.modules.hasOwnProperty(e.resolve(b))},e};var b=this;b.require="undefined"!=typeof b.require?b.require:a,function(){b.require.register("em/src/app.js",function(a,b,c){var d,e,f,g,h,i,j,k;j=b("./modules/results"),k=b("./modules/state"),f=b("./modules/ejs"),h=b("./modules/query"),i=b("./modules/render"),g=b("./modules/helpers"),e=["document","label","results","search","title","more"],d=can.Control({init:function(){var a,c,d,f;for(d=0,f=e.length;f>d;d++)c=e[d],b("./components/"+c);return a=b("./templates/layout"),this.element.html(i(a,g))},route:function(){var a;return a=b("./templates/page/index"),this.render(a,{},"ElasticMed")},"doc/:oid route":function(a){var c,d,e,g,h=this;return g=a.oid,e=function(a){var c,d;return c=b("./templates/page/detail"),_.isObject(d=a.attr("title"))&&(d=d.value),h.render(c,a,""+d+" - ElasticMed")},c=null,(d=j.attr("docs")).length&&d.each(function(a){return c?void 0:a.attr("oid")===g?c=a:void 0}),c?e(c):f.get(g,function(a,b){return a?k.error(a):e(b)})},render:function(a,b,c){return this.element.find(".content").html(i(a,b)),document.title=c}}),c.exports=function(a){var b,c,e;return c=a.service,b=a.index,e=a.type,f.attr({index:b,type:e,client:new $.es.Client({hosts:c})}),new d(a.el),can.route.ready(),can.route.current("")?h.attr("current",a.query||""):void 0}}),b.require.register("em/src/components/document.js",function(a,b,c){c.exports=can.Component.extend({tag:"app-document",template:b("../templates/document"),scope:{linkToDetail:"@"},helpers:{ago:function(a){var b,c,d,e;return e=a(),d=e.year,c=e.month,b=e.day,moment([d,c,b].join(" ")).fromNow()},date:function(a){var b,c,d,e;return e=a(),b=e.day,c=e.month,d=e.year,[b,c,d].join(" ")},isPublished:function(a,b){var c,d,e,f,g;return g=a(),c=g.day,d=g.month,f=g.year,e=+moment([c,d,f].join(" ")),(e||1/0)>+new Date?b.inverse(this):b.fn(this)},author:function(a){var b;return(b=a.collectivename)?b:a.forename+" "+a.lastname},highlight:function(a){var b,c,d,e,f,g;if(a=a(),!_.isObject(a))return a;if(!a.highlights.length)return a.value;for(g=a.highlights,e=0,f=g.length;f>e;e++)c=g[e],d=c.replace(/<\/?em>/g,""),b=a.value.replace(d,c);return b},hint:function(a,b){var c,d,e,f,g,h;if((a=a())<b)return a;for(h=e=a.split(" "),c=f=0,g=h.length;g>f;c=++f)if(d=h[c],b-=d.length,!(b>0))return e.slice(0,+c+1||9e9).join(" ")+" ..."}}})}),b.require.register("em/src/components/label.js",function(a,b,c){var d;d=b("../modules/colorize"),c.exports=can.Component.extend({tag:"app-label",template:b("../templates/label"),helpers:{bg:function(a){return d(a())},fg:function(a){var b,c;return b=d(a()),c=d3.hsl(b).l,.5>c?"light":"dark"},round:function(a){return Math.round(100*a())}}})}),b.require.register("em/src/components/more.js",function(a,b,c){var d,e,f;e=b("../modules/ejs"),d=new can.List([]),f=can.compute(!1),c.exports=can.Component.extend({tag:"app-more",template:b("../templates/more"),scope:function(a,b){return f(!0),d.replace([]),e.more(b.attr("oid"),function(a,b){return f(!1),a?void 0:d.replace(b)}),{docs:d}},helpers:{isWorking:function(a){return f()?a.fn(this):a.inverse(this)}}})}),b.require.register("em/src/components/results.js",function(a,b,c){var d;d=b("../modules/results"),c.exports=can.Component.extend({tag:"app-results",template:b("../templates/results"),scope:function(a,b){var c;return(c=b.attr("docs"))?{docs:c}:d}})}),b.require.register("em/src/components/search.js",function(a,b,c){var d,e,f,g,h,i;g=b("../modules/query"),e=b("../modules/ejs"),i=new can.Map({value:"",caret:0,px:0,list:[],setList:function(a){return _.map(a,function(a,b){var c;return c=a.text,{text:c,active:!b}})}}),f=function(a){var b;if(b=a.attr("active"))return a.attr("active",!1),!0},d=function(a,b){var c,d,e,f,g;return g=b.val(),c=b.prop("selectionStart"),d=g.slice(0,c).replace(/([^\s]+)$/,"^"),f=g.slice(c).replace(/(^[^\s]+)/,"^"),g=(d+f).replace(/\^+/,""+a+"^"),b.val(g.replace("^","")),e=g.indexOf("^"),b[0].setSelectionRange(e,e)},h=function(a,b){var c,d,f,h;if((f=a.val()).length){if(13===(d=b.keyCode||b.which))return g.attr("current",f);if(9!==d&&38!==d&&40!==d){if(c=a.prop("selectionStart"),f.slice(Math.max(c-1,0),+c+1||9e9).match(/^\s+$/))return i.attr("list",[]);h="";try{h+=f.slice(0,c).match(/([^\s]+)$/)[1]}catch(j){}try{h+=f.slice(c).match(/(^[^\s]+)/)[1]}catch(j){}return i.attr("px",this.element.find(".faux").text(f.slice(0,c).replace(/\s/g,"Â ")).outerWidth()),e.suggest(h,function(a,b){var c;if(!a&&(c=b[h]))return i.attr("list",c)})}}},c.exports=can.Component.extend({tag:"app-search",template:b("../templates/search"),scope:function(){return{query:g,suggestions:i}},events:{"a.button click":function(){return g.attr("current",this.element.find("input").val())},".suggestions li mouseover":function(a){var b,c;if((b=i.attr("list")).length)return _.find(b,f),c=a.find("a").text(),_.find(b,function(a){return a.attr("text")===c?a.attr("active",!0):void 0})},".suggestions li click":function(a){var b;return b=this.element.find("input.text"),d(a.find("a").text(),b),i.attr("list",[]),b.focus()},"input.text keydown":function(a,b){var c,e,g,h,j;switch(c=function(a){var c,d;if((d=i.attr("list")).length){switch(a){case 38:c=_.findIndex(d,f)||0,(c-=1)<0&&(c=d.length-1);break;case 40:c=_.findIndex(d,f),_.isUndefined(c)&&(c=d.length-1),(c+=1)===d.length&&(c=0)}return d[c].attr("active",!0),b.preventDefault()}},g=b.keyCode||b.which){case 9:if(!(h=i.attr("list")).length)return;if(!(e=_.find(h,f)))return;return j=e.attr("text"),d(j,a),i.attr("list",[]),b.preventDefault();case 38:case 40:return c(g);case 27:return i.attr("list",[]),a.blur()}},"input.text keyup":h,"input.text click":h,".breadcrumbs a click":function(a){return g.attr("current",a.text())}}})}),b.require.register("em/src/components/title.js",function(a,b,c){var d;d=b("../modules/state"),c.exports=can.Component.extend({tag:"app-title",template:b("../templates/title"),scope:function(){return d}})}),b.require.register("em/src/models/document.js",function(a,b,c){var d,e,f=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};e=window.localStorage,c.exports=d=can.Model.extend({}),d.List=d.List.extend({dbName:"elastic-med",keys:null,init:function(a,b){var c,d,g,h,i,j,k,l,m,n;if(null==b&&(b=!1),d=e.getItem(this.dbName),this.keys=d&&d.split(",")||[],b&&this.keys.length){for(l=this.keys,n=[],h=0,j=l.length;j>h;h++)g=l[h],n.push(this.push(JSON.parse(e.getItem(""+this.dbName+"-"+g))));return n}for(i=0,k=a.length;k>i;i++)c=a[i],e.setItem(""+this.dbName+"-"+c.oid,JSON.stringify(c)),m=c.oid,f.call(this.keys,m)<0&&this.keys.push(c.oid);return e.setItem(this.dbName,this.keys.join(","))},destroy:function(){var a,b,c,d;for(d=this.keys,b=0,c=d.length;c>b;b++)a=d[b],e.removeItem(""+this.dbName+"-"+a);return e.removeItem(this.dbName),this.keys=[]}})}),b.require.register("em/src/modules/colorize.js",function(a,b,c){var d,e,f;d=colorbrewer.YlOrRd[9],f=.2,e=2.5,c.exports=function(){var a;return a=d3.scale.linear().domain(d3.range(f,e,(e-f)/(d.length-1))).range(d),_.memoize(function(b){return a(Math.max(f,Math.min(e,b)))})}()}),b.require.register("em/src/modules/ejs.js",function(a,b,c){var d;d={},c.exports=new can.Map({client:null,index:null,type:null,size:10,search:function(a,b){return this.client?this.client.search({index:this.index,type:this.type,body:{size:this.size,query:{multi_match:{query:a,fields:["title^2","keywords^2","abstract"]}},highlight:{fields:{title:{},"abstract":{}}}}}).then(function(a){var c,d,e;try{c=JSON.parse(a.body)}catch(f){return e=f,b("Malformed response")}return d=_.map(c.hits.hits,function(a){var b,c,d,e,f,g;f=a._score,e=a._id,g=a._source,b=a.highlight,g.score=f,g.oid=e;for(c in g)d=g[c],("title"===c||"abstract"===c)&&(g[c]={value:d,highlights:(null!=b?b[c]:void 0)||[]});return g}),b(null,{docs:d,total:c.hits.total})},b):b("Client is not setup")},get:function(a,b){return this.client?this.client.get({index:this.index,type:this.type,id:a}).then(function(a){var c,d;try{c=JSON.parse(a.body)}catch(e){return d=e,b("Malformed response")}return b(null,new can.Map(_.extend(c._source,{oid:c._id})))},b):b("Client is not setup")},suggest:function(a,b){var c;return this.client?a in d?b(null,d[a]):(c={completion:{text:a,term:{field:"title"}}},this.client.suggest({index:this.index,body:c}).then(function(e){var f,g,h,i,j,k,l;try{c=JSON.parse(e.body)}catch(m){return f=m,b("Malformed response")}for(g={},k=c.completion,i=0,j=k.length;j>i;i++)l=k[i],a=l.text,h=l.options,g[a]=h;return d[a]=g,b(null,g)},b)):b("Client is not setup")},more:function(a,b){return this.client?this.client.mlt({index:this.index,type:this.type,id:a,mlt_fields:"title",percentTermsToMatch:.1}).then(function(a){var c,d;try{c=JSON.parse(a.body)}catch(e){return d=e,b("Malformed response")}return b(null,_.map(c.hits.hits,function(a){var b,c,d;return b=a._id,c=a._score,d=a._source,d.oid=b,d.score=c,d}))},b):b("Client is not setup")}})}),b.require.register("em/src/modules/helpers.js",function(a){var b,c;a.link=c=function(a){return a?can.route.url({oid:a()}):"#!"},a.ifs=b=function(a,b){return _.isFunction(a)&&(a=a()),"true"===a?b.fn(this):b.inverse(this)},Mustache.registerHelper("link",c),Mustache.registerHelper("ifs",b)}),b.require.register("em/src/modules/query.js",function(a,b,c){var d,e,f;d=b("./ejs"),f=b("./state"),e=new can.Map({current:"",history:[]}),e.bind("current",function(a,b){var c;return(c=this.attr("history").slice(0,2)).splice(0,0,b),this.attr("history",c),f.loading(),d.search(b,function(a,b){var c,d;return d=b.total,c=b.docs,a?f.error(a):d?f.hasResults(d,c):f.noResults()})}),c.exports=e}),b.require.register("em/src/modules/render.js",function(a,b,c){c.exports=function(a,b){return null==b&&(b={}),can.view.mustache(a)(b)}}),b.require.register("em/src/modules/results.js",function(a,b,c){var d;d=b("../models/document"),c.exports=new can.Map({total:0,docs:new d.List([],!0)})}),b.require.register("em/src/modules/state.js",function(a,b,c){var d,e,f,g,h;g=b("./results"),f=b("./ejs"),d=b("../models/document"),e=can.Map.extend({loading:function(){return h.attr("text","Loading results &hellip;").attr("class","info"),g.attr("docs").destroy(),g.attr("total",0)},hasResults:function(a,b){return h.attr("class","info"),a>f.attr("size")?h.attr("text","Top results out of "+a+" matches"):1===a?h.attr("text","1 Result"):h.attr("text",""+a+" Results"),g.attr("docs").destroy(),g.attr("total",a).attr("docs",new d.List(b))},noResults:function(){return h.attr("text","No results found").attr("class","info"),g.attr("docs").destroy(),g.attr("total",0)},error:function(a){var b;switch(b="Error",!1){case!_.isString(a):b=a;break;case!_.isObject(a&&a.message):b=a.message}return h.attr("text",b).attr("class","alert"),g.attr("docs").destroy(),g.attr("total",0)}}),c.exports=h=new e({text:"Search ready","class":"info"})}),b.require.register("em/src/templates/breadcrumbs.js",function(a,b,c){c.exports=['<nav class="ink-navigation">','    <ul class="breadcrumbs">',"        <li><a>Start</a></li>","        <li><a>Level 1</a></li>","        <li><a>Level 2</a></li>",'        <li class="current"><a>Current item</a></li>',"    </ul>","</nav>"].join("\n")}),b.require.register("em/src/templates/document.js",function(a,b,c){c.exports=['<div class="body">','    <div class="title">',"        <app-label></app-label>",'        <h4 class="highlight">{{{ highlight title }}}</h4>',"    </div>","",'    <ul class="authors">',"        {{ #authors }}","        {{ #if affiliation }}",'        <li><span class="hint--top" data-hint="{{ hint affiliation 30 }}">{{ author this }}</span></li>',"        {{ else }}","        <li>{{ author this }}</li>","        {{ /if }}","        {{ /authors }}","    </ul>","",'    <em class="journal">in {{ journal }}</em>',"","    {{ #isPublished issue.published }}",'    <div class="meta hint--top" data-hint="{{ date issue.published }}">Published {{ ago issue.published }}</div>',"    {{ else }}",'    <div class="meta">In print</div>',"    {{ /isPublished }}","","    {{ #id.pubmed }}",'    <div class="meta">','    PubMed: <a target="{{ id.pubmed }}" href="http://www.ncbi.nlm.nih.gov/pubmed/{{ id.pubmed }}">{{ id.pubmed }}</a>',"    </div>","    {{ /id.pubmed }}","    ","    {{ #id.doi }}",'    <div class="meta">','    DOI: <a target="{{ id.doi }}" href="http://dx.doi.org/{{ id.doi }}">{{ id.doi }}</a>',"    </div>","    {{ /id.doi }}","</div>","","{{ #ifs linkToDetail }}",'<a class="preview" href="{{ link oid }}">','    <div class="abstract highlight">',"        {{{ highlight abstract }}}",'        <div class="fa fa-eye"></div>',"    </div>","</a>","{{ else }}",'<div class="abstract highlight">',"    {{{ highlight abstract }}}","</div>","{{ /ifs }}"].join("\n")}),b.require.register("em/src/templates/label.js",function(a,b,c){c.exports=["{{ #score }}",'<span class="score {{ fg score }}" style="background-color:{{ bg score }}">{{ round score }}</span>',"{{ /score }}"].join("\n")}),b.require.register("em/src/templates/layout.js",function(a,b,c){c.exports=['<div class="box">','    <h2><a href="{{ link null }}">ElasticMed</a></h2>','    <div class="content"></div>',"</div>"].join("\n")}),b.require.register("em/src/templates/more.js",function(a,b,c){c.exports=["{{ #isWorking }}",'<h5>Looking for similar documents <span class="fa fa-spinner"></span></h5>',"{{ /isWorking }}","","{{ #if docs.length }}","<h4>Similar documents</h4>","<app-results></app-results>","{{ /if }}"].join("\n")}),b.require.register("em/src/templates/notification.js",function(a,b,c){c.exports=["{{ #state.alert.show }}",'<div class="alert-box {{ state.alert.type }}">',"    <p>{{{ state.alert.text }}}</p>",'    <a class="close">&times;</a>',"</div>","{{ /state.alert.show }}"].join("\n")}),b.require.register("em/src/templates/page/detail.js",function(a,b,c){c.exports=['<div class="page detail">',"    <app-title></app-title>",'    <div class="document detail">','        <app-document link-to-detail="false"></app-document>',"    </div>","    <app-more></app-more>","<div>"].join("\n")}),b.require.register("em/src/templates/page/index.js",function(a,b,c){c.exports=["<p>ElasticSearch through a collection of cancer related publications from PubMed. Use <kbd>Tab</kbd> to autocomplete or <kbd>Enter</kbd> to search.</p>",'<div class="page index">',"    <app-search></app-search>","    <app-title></app-title>","    <app-results></app-results>","</div>"].join("\n")}),b.require.register("em/src/templates/results.js",function(a,b,c){c.exports=["{{ #if docs.length }}",'<ul class="results">',"    {{ #docs }}",'    <li class="document result">','        <app-document link-to-detail="true"></app-document>',"    </li>","    {{ /docs }}","</ul>","{{ /if }}"].join("\n")}),b.require.register("em/src/templates/search.js",function(a,b,c){c.exports=['<div class="row collapse">','    <div class="large-10 columns search">','        <div class="faux"></div>','        <input class="text" type="text" maxlength="100" placeholder="Query..." value="{{ query.current }}" autofocus>',"        {{ #if suggestions.list.length }}",'        <ul class="f-dropdown suggestions" style="left:{{ suggestions.px }}px">',"        {{ #suggestions.list }}",'            <li {{ #active }}class="active"{{ /active }}>',"                <a>{{ text }}</a>","            </li>","        {{ /suggestions.list }}","        </ul>","        {{ /if }}","    </div>",'    <div class="large-2 columns">','        <a class="button secondary postfix">','            <span class="fa fa-search"></span> Search',"        </a>","    </div>","</div>","{{ #if query.history.length }}",'<div class="row collapse">',"    <h4>History</h4>",'    <ul class="breadcrumbs">',"    {{ #query.history }}","        <li><a>{{ . }}</a></li>","    {{ /query.history }}","</div>","{{ /if }}"].join("\n")}),b.require.register("em/src/templates/title.js",function(a,b,c){c.exports=['<h3 class="{{ class }}">{{{ text }}}</h3>'].join("\n")})}();var c=b.require("em/src/app.js");"undefined"!=typeof define&&define.amd?define("em",[],function(){return c}):"undefined"!=typeof module&&module.exports?module.exports=c:b.em=c,b.require.alias("em/src/app.js","em/index.js")}();